{% extends "base.html" %}
{% block content %}

<div class="container">
    <p>state token = {{ STATE }}</p>
    <div id="signinButton">
        <span class="g-signin"
            data-scope="profile openid email"
            data-clientid="61683668295-cchsh7fkgkkvad14lsl49gcogftsor3l.apps.googleusercontent.com"
            data-redirecturi="postmessage"
            data-accesstype="offline"
            data-cookiepolicy="single_host_origin"
            data-callback="signInCallback"
            data-approvalprompt="force">
        </span>
    </div>
    <div id="result"></div>
</div>

<script>
function signInCallback(authResult) {
    if (authResult["code"]) {
        console.log("one-time code " + authResult["code"]);
        $("#signinButton").attr("style", "display: none");

        $.ajax({
            type: "POST",
            url: "/gconnect?state={{STATE}}",
            processData: false,
            contentType: "application/octet-stream; charse=utf-8",
            data: authResult["code"],
            success: function(result) {
                if (result) {
                    $("#result").html("Login Successful!<br>" + result + "<br>Redirecting...")
                    setTimeout(function() {
                        window.location.href = "/restaurant";
                    }, 4000);
                } else if (authResult["error"]) {
                    console.log("There was an error: " + authResult["error"]);
                } else {
                    $("#result").html("Failed to make a server-side call. Check your configuration and console.");
                }
            }
        });
    }
};
</script>

{% endblock %}

